\doxysection{Scene\+Receiver.\+h}
\hypertarget{_scene_receiver_8h_source}{}\label{_scene_receiver_8h_source}\index{C:/Users/m5963/Documents/GitHub/AnimHost/AnimHost/animHost\_Plugins/TracerSceneReceiverPlugin/SceneReceiver.h@{C:/Users/m5963/Documents/GitHub/AnimHost/AnimHost/animHost\_Plugins/TracerSceneReceiverPlugin/SceneReceiver.h}}
\mbox{\hyperlink{_scene_receiver_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#ifndef\ SCENERECEIVER\_H}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#define\ SCENERECEIVER\_H}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_z_m_q_message_handler_8h}{ZMQMessageHandler.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_tracer_scene_receiver_plugin_8h}{TracerSceneReceiverPlugin.h}}"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <QMutex>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <QThread>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <nzmqt/nzmqt.hpp>}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{class\ }TRACERSCENERECEIVERPLUGINSHARED\_EXPORT\ \mbox{\hyperlink{class_scene_receiver}{SceneReceiver}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_z_m_q_message_handler}{ZMQMessageHandler}}\ \{}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \ \ \ \ Q\_OBJECT}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00031\ \ \ \ \ \mbox{\hyperlink{class_scene_receiver_afef8037d8aed0ab4cbd2590e22eb960e}{SceneReceiver}}()\ \{\}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00040\ \ \ \ \ \mbox{\hyperlink{class_scene_receiver_ab0bc0a73eee5a7777d1d03d6a9ed888c}{SceneReceiver}}(\mbox{\hyperlink{class_tracer_scene_receiver_plugin}{TracerSceneReceiverPlugin}}*\ m\_TSRPlugin,\ QString\ \_senderIP,\ \textcolor{keywordtype}{bool}\ m\_debugState,\ zmq::context\_t*\ m\_context)\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ TSRPlugin\ =\ m\_TSRPlugin;}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ senderIP\ =\ \_senderIP;}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \_debug\ =\ m\_debugState;}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ context\ =\ m\_context;}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \_stop\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \_working\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \_paused\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ receiveSocket\ =\ \textcolor{keyword}{new}\ zmq::socket\_t(*context,\ zmq::socket\_type::req);\ \textcolor{comment}{//\ initialising\ the\ socket\ with\ a\ Request-\/Reply\ pattern}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ THIS\ TRIGGERS\ NULLPOINTER-\/RELATED\ EXCEPTION}}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ open\ socket}}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*receiveSocket\ =\ new\ zmq::socket\_t(*context,\ zmq::socket\_type::req);}}
\DoxyCodeLine{00054\ \textcolor{comment}{\ \ \ \ \ \ \ \ receiveSocket-\/>connect(QString("{}tcp://"{}\ +\ ipAddress\ +\ "{}:5555"{}).toLatin1().data());}}
\DoxyCodeLine{00055\ \textcolor{comment}{\ \ \ \ \ \ \ \ receiveSocket-\/>setsockopt(ZMQ\_REQ,\ "{}request\ scene"{},\ 0);*/}}
\DoxyCodeLine{00056\ \ \ \ \ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00064\ \ \ \ \ \mbox{\hyperlink{class_scene_receiver_a47fe64ed8d3051e075c6ad2ec49b7c96}{SceneReceiver}}(QString\ \_senderIP,\ \textcolor{keywordtype}{bool}\ m\_debugState,\ zmq::context\_t*\ m\_context)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ senderIP\ =\ \_senderIP;}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \_debug\ =\ m\_debugState;}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ context\ =\ m\_context;}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \_stop\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \_working\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \_paused\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ receiveSocket\ =\ \textcolor{keyword}{new}\ zmq::socket\_t(*context,\ zmq::socket\_type::req);}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ THIS\ TRIGGERS\ NULLPOINTER-\/RELATED\ EXCEPTION}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ open\ socket}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*receiveSocket\ =\ new\ zmq::socket\_t(*context,\ zmq::socket\_type::req);}}
\DoxyCodeLine{00077\ \textcolor{comment}{\ \ \ \ \ \ \ \ receiveSocket-\/>connect(QString("{}tcp://"{}\ +\ ipAddress\ +\ "{}:5555"{}).toLatin1().data());}}
\DoxyCodeLine{00078\ \textcolor{comment}{\ \ \ \ \ \ \ \ receiveSocket-\/>setsockopt(ZMQ\_REQ,\ "{}request\ scene"{},\ 0);*/}}
\DoxyCodeLine{00079\ \ \ \ \ \};}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00082\ \ \ \ \ \mbox{\hyperlink{class_scene_receiver_adc4d5dc72454fe16f33541187e29bada}{\string~SceneReceiver}}()\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ receiveSocket-\/>close();}
\DoxyCodeLine{00084\ \ \ \ \ \};}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_scene_receiver_a1691a7d534569795c77f36f0097340d2}{requestStart}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ mutex.lock();}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \_working\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \_stop\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \_paused\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ qDebug()\ <<\ \textcolor{stringliteral}{"{}AnimHost\ Scene\ Receiver\ requested\ to\ start"{}};\textcolor{comment}{//\ in\ Thread\ "{}<<thread()-\/>currentThreadId();}}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ mutex.unlock();}
\DoxyCodeLine{00097\ \ \ \ \ \};}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_scene_receiver_ac6d6e6848698fa8910af947b29a8e930}{requestStop}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ mutex.lock();}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_working)\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \_stop\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \_paused\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\_working\ =\ false;}}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ qDebug()\ <<\ \textcolor{stringliteral}{"{}AnimHost\ Scene\ Receiver\ stopping"{}};\textcolor{comment}{//\ in\ Thread\ "{}<<thread()-\/>currentThreadId();}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ mutex.unlock();}
\DoxyCodeLine{00112\ \ \ \ \ \};}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_scene_receiver_a2db842fc1829d7e51ddeb3d5313fe99d}{requestCharacterData}}()\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ std::string\ charReq\ =\ \textcolor{stringliteral}{"{}characters"{}};}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ requestMsg.rebuild(charReq.c\_str(),\ charReq.size());}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ qDebug()\ <<\ \textcolor{stringliteral}{"{}Requesting\ character\ packages"{}};}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ receiveSocket-\/>send(requestMsg);}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ receiveSocket-\/>recv(\&replyCharMsg);}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ qDebug()\ <<\ \textcolor{stringliteral}{"{}Reply\ received!"{}};}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ QByteArray*\ charPkgArray\ =\ \textcolor{keyword}{new}\ QByteArray();}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ replyCharMsg\ will\ contain\ a\ series\ of\ bytes\ representing\ the\ Characters\ in\ the\ scene}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (replyCharMsg.size()\ >\ 0)}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ charPkgArray-\/>append((\textcolor{keywordtype}{char}*)replyCharMsg.data(),\ replyCharMsg.size());\ \textcolor{comment}{//\ Convert\ message\ into\ explicit\ byte\ array}}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ passCharacterByteArray(charPkgArray);\ \textcolor{comment}{//\ Pass\ byte\ array\ to\ TracerSceneReceiverPlugin\ to\ be\ parsed\ as\ chracter\ packages}}
\DoxyCodeLine{00134\ \ \ \ \ \}}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_scene_receiver_a7fe0337bb60eb6dcd7c41fe0c42d50dc}{requestSceneNodeData}}()\ \{}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ std::string\ nodesReq\ =\ \textcolor{stringliteral}{"{}nodes"{}};}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ requestMsg.rebuild(nodesReq.c\_str(),\ nodesReq.size());}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ qDebug()\ <<\ \textcolor{stringliteral}{"{}Requesting\ nodes"{}};}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ receiveSocket-\/>send(requestMsg);}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ receiveSocket-\/>recv(\&replyNodeMsg);}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ qDebug()\ <<\ \textcolor{stringliteral}{"{}Reply\ received!"{}};}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ QByteArray*\ nodesArray\ =\ \textcolor{keyword}{new}\ QByteArray();}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ replyNodeMsg\ will\ contain\ a\ series\ of\ bytes\ representing\ all\ the\ Scene\ Nodes\ in\ the\ scene}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (replyNodeMsg.size()\ >\ 0)}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ nodesArray-\/>append((\textcolor{keywordtype}{char}*)\ replyNodeMsg.data(),\ replyNodeMsg.size());}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ passSceneNodeByteArray(nodesArray);\ \textcolor{comment}{//\ Pass\ byte\ array\ to\ TracerSceneReceiverPlugin\ to\ be\ parsed\ as\ scene\ nodes}}
\DoxyCodeLine{00156\ \ \ \ \ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_scene_receiver_a45af17186a57bc5a1793ee469ca20965}{requestHeaderData}}()\ \{}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ std::string\ headReq\ =\ \textcolor{stringliteral}{"{}header"{}};}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ requestMsg.rebuild(headReq.c\_str(),\ headReq.size());}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ qDebug()\ <<\ \textcolor{stringliteral}{"{}Requesting\ nodes"{}};}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ receiveSocket-\/>send(requestMsg);}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ receiveSocket-\/>recv(\&replyHeaderMsg);}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ qDebug()\ <<\ \textcolor{stringliteral}{"{}Reply\ received!"{}};}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ QByteArray*\ headerArray\ =\ \textcolor{keyword}{new}\ QByteArray();}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ replyHeaderMsg\ will\ contain\ a\ series\ of\ bytes\ encoding\ basic\ global\ data\ of\ the\ scene\ and\ its\ client/server}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (replyHeaderMsg.size()\ >\ 0)}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ headerArray-\/>append((\textcolor{keywordtype}{char}*)\ replyHeaderMsg.data(),\ replyHeaderMsg.size());}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ passHeaderByteArray(headerArray);\ \textcolor{comment}{//\ Pass\ byte\ array\ to\ TracerSceneReceiverPlugin\ to\ be\ parsed\ as\ header\ data}}
\DoxyCodeLine{00178\ \ \ \ \ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_scene_receiver_a83bf02e624d24cfc6813699009945bf4}{connectSocket}}(QString\ newIPAddress\ =\ \textcolor{stringliteral}{"{}"{}})\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*if\ (receiveSocket-\/>connected())}}
\DoxyCodeLine{00187\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ receiveSocket-\/>disconnect(QString("{}tcp://"{}\ +\ ipAddress\ +\ "{}:5555"{}).toLatin1().data());\ //disconnect\ throws\ unexpected\ exception*/}}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!newIPAddress.isEmpty())}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ senderIP\ =\ newIPAddress;}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ receiveSocket-\/>connect(QString(\textcolor{stringliteral}{"{}tcp://"{}}\ +\ senderIP\ +\ \textcolor{stringliteral}{"{}:5555"{}}).toLatin1().data());}
\DoxyCodeLine{00192\ \ \ \ \ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00195\ \ \ \ \ zmq::socket\_t*\ receiveSocket\ =\ \textcolor{keyword}{nullptr};\ }
\DoxyCodeLine{00196\ \ \ \ \ QString\ \mbox{\hyperlink{class_scene_receiver_ad3163bcf409911ecb844e3fc480d848b}{senderIP}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \mbox{\hyperlink{class_tracer_scene_receiver_plugin}{TracerSceneReceiverPlugin}}*\ TSRPlugin\ =\ \textcolor{keyword}{nullptr};\ }
\DoxyCodeLine{00199\ \ \ \ \ zmq::message\_t\ requestMsg\ \{\};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00200\ \ \ \ \ zmq::message\_t\ replyNodeMsg\ \{\};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00201\ \ \ \ \ zmq::message\_t\ replyHeaderMsg\ \{\};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00202\ \ \ \ \ zmq::message\_t\ replyCharMsg\ \{\};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keyword}{public}\ Q\_SLOTS:}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_scene_receiver_a303b19fc66967f61c105dba0bca4a36f}{run}}()\ \{\}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \ \ Q\_SIGNALS:}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_scene_receiver_a5fefb26044066f17fabe4436bf0b3ea0}{stopped}}();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_scene_receiver_aac3081441382c20e9e0a0153600816c8}{passCharacterByteArray}}(QByteArray*\ characterMsgArray);\ }
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_scene_receiver_a18608812fc2d995b59b2f9cf6aaf11d8}{passSceneNodeByteArray}}(QByteArray*\ sceneNodeMsgArray);\ }
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_scene_receiver_aa713ed100e236db310a580860bcdaf99}{passHeaderByteArray}}(QByteArray*\ headerMsgArray);\ \ \ \ \ \ \ }
\DoxyCodeLine{00213\ \};}
\DoxyCodeLine{00214\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ SCENERECEIVER\_H}}

\end{DoxyCode}
