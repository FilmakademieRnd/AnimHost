<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AnimHost: Training C &amp; C++ APIs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AnimHost<span id="projectnumber">&#160;0.5</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">ONNX Runtime</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Training C &amp; C++ APIs</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Training C and C++ APIs are an extension of the <a class="el" href="c_cpp_api.html">onnxruntime core C and C++ APIs</a> and should be used in conjunction with them.</p>
<p>In order to train a model with onnxruntime, the following training artifacts must be generated:</p><ul>
<li>The training onnx model</li>
<li>The checkpoint directory</li>
<li>The optimizer onnx model</li>
<li>The eval onnx model model (optional)</li>
</ul>
<p>These training artifacts can be generated as part of an offline step using the python <a href="https://github.com/microsoft/onnxruntime/blob/main/orttraining/orttraining/python/training/onnxblock/README.md">utilities</a> made available in the <code>onnxruntime-training</code> python package.</p>
<p>After these artifacts have been generated, the C and C++ utilities listed in this documentation can be leveraged to perform training.</p>
<p>If any problem is encountered, please create an <a href="https://github.com/microsoft/onnxruntime/issues/new">issue</a> with your scenario and requirements, and we will be sure to respond and follow up on the request.</p>
<h1>Training C API</h1>
<p><a class="el" href="struct_ort_training_api.html" title="The Training C API that holds onnxruntime training function pointers.">OrtTrainingApi</a> - Training C API functions.</p>
<p>This C structure contains functions that enable users to perform training with onnxruntime.</p>
<p><em>Sample Code</em>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;onnxruntime_training_api.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="struct_ort_api.html">OrtApi</a>* g_ort_api = <a class="code hl_function" href="group___global.html#gaf542347444820afe571db318ffcc8101">OrtGetApiBase</a>()-&gt;<a class="code hl_function" href="struct_ort_api_base.html#a528209c52d82a5b4c61fe609a6fc6204">GetApi</a>(<a class="code hl_define" href="group___global.html#gac583aeb4640621ceb588f6300537945d">ORT_API_VERSION</a>);</div>
<div class="line"><a class="code hl_struct" href="struct_ort_training_api.html">OrtTrainingApi</a>* g_ort_training_api = g_ort_api-&gt;<a class="code hl_function" href="struct_ort_api.html#ac714d93e08c879793e642e7427a86546">GetTrainingApi</a>(<a class="code hl_define" href="group___global.html#gac583aeb4640621ceb588f6300537945d">ORT_API_VERSION</a>);</div>
<div class="line"> </div>
<div class="line">OrtEnv* env = NULL;</div>
<div class="line">g_ort_api-&gt;CreateEnv(logging_level, logid, &amp;env);</div>
<div class="line">OrtSessionOptions* session_options = NULL;</div>
<div class="line">g_ort_api-&gt;CreateSessionOptions(&amp;session_options);</div>
<div class="line"> </div>
<div class="line">OrtCheckpointState* state = NULL;</div>
<div class="line">g_ort_training_api-&gt;LoadCheckpoint(path_to_checkpoint, &amp;state);</div>
<div class="line"> </div>
<div class="line">OrtTrainingSession* training_session = NULL;</div>
<div class="line">g_ort_training_api-&gt;CreateTrainingSession(env, session_options, training_model_path,</div>
<div class="line">                                          state, eval_model_path, optimizer_model_path,</div>
<div class="line">                                          &amp;training_session);</div>
<div class="line"><span class="comment">// Training loop</span></div>
<div class="line">{</div>
<div class="line">    g_ort_training_api-&gt;TrainStep(...);</div>
<div class="line">    g_ort_training_api-&gt;OptimizerStep(...);</div>
<div class="line">    g_ort_training_api-&gt;LazyResetGrad(...);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">g_ort_training_api-&gt;ExportModelForInferencing(training_session, inference_model_path, ...);</div>
<div class="line">g_ort_training_api-&gt;SaveCheckpoint(state, path_to_checkpoint, <span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">g_ort_training_api-&gt;ReleaseTrainingSession(training_session);</div>
<div class="line">g_ort_training_api-&gt;ReleaseCheckpointState(state);</div>
<div class="ttc" id="agroup___global_html_gac583aeb4640621ceb588f6300537945d"><div class="ttname"><a href="group___global.html#gac583aeb4640621ceb588f6300537945d">ORT_API_VERSION</a></div><div class="ttdeci">#define ORT_API_VERSION</div><div class="ttdoc">The API version defined in this header.</div><div class="ttdef"><b>Definition</b> onnxruntime_c_api.h:40</div></div>
<div class="ttc" id="agroup___global_html_gaf542347444820afe571db318ffcc8101"><div class="ttname"><a href="group___global.html#gaf542347444820afe571db318ffcc8101">OrtGetApiBase</a></div><div class="ttdeci">ORT_EXPORT const OrtApiBase *ORT_API_CALL OrtGetApiBase(void) NO_EXCEPTION</div><div class="ttdoc">The Onnxruntime library's entry point to access the C API.</div></div>
<div class="ttc" id="astruct_ort_api_base_html_a528209c52d82a5b4c61fe609a6fc6204"><div class="ttname"><a href="struct_ort_api_base.html#a528209c52d82a5b4c61fe609a6fc6204">OrtApiBase::GetApi</a></div><div class="ttdeci">const OrtApi *ORT_API_CALL * GetApi(uint32_t version) NO_EXCEPTION</div><div class="ttdoc">Get a pointer to the requested version of the OrtApi.</div></div>
<div class="ttc" id="astruct_ort_api_html"><div class="ttname"><a href="struct_ort_api.html">OrtApi</a></div><div class="ttdoc">The C API.</div><div class="ttdef"><b>Definition</b> onnxruntime_c_api.h:687</div></div>
<div class="ttc" id="astruct_ort_api_html_ac714d93e08c879793e642e7427a86546"><div class="ttname"><a href="struct_ort_api.html#ac714d93e08c879793e642e7427a86546">OrtApi::GetTrainingApi</a></div><div class="ttdeci">const OrtTrainingApi *ORT_API_CALL * GetTrainingApi(uint32_t version) NO_EXCEPTION</div><div class="ttdoc">Gets the Training C Api struct.</div></div>
<div class="ttc" id="astruct_ort_training_api_html"><div class="ttname"><a href="struct_ort_training_api.html">OrtTrainingApi</a></div><div class="ttdoc">The Training C API that holds onnxruntime training function pointers.</div><div class="ttdef"><b>Definition</b> onnxruntime_training_c_api.h:122</div></div>
</div><!-- fragment --><blockquote class="doxtable">
<p>&zwj;<b>Note</b> The ::OrtCheckpointState contains the entire training state that the ::OrtTrainingSession uses. As a result, the training session must always have access to the state. That is to say, the ::OrtCheckpointState instance must outlive the lifetime of the ::OrtTrainingSession instance. </p>
</blockquote>
<h1>Training C++ API</h1>
<p><a class="el" href="group___training_cpp.html">Ort Training C++ API</a> - Training C++ API classes and functions.</p>
<p>These C++ classes and functions enable users to perform training with onnxruntime.</p>
<p><em>Sample Code</em>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;onnxruntime_training_cxx_api.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="struct_ort_1_1_env.html">Ort::Env</a> env;</div>
<div class="line"><a class="code hl_struct" href="struct_ort_1_1_session_options.html">Ort::SessionOptions</a> session_options;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> state = <a class="code hl_function" href="class_ort_1_1_checkpoint_state.html#a0afa164a5656c00f59c5f5bcab17dce2">Ort::CheckpointState::LoadCheckpoint</a>(path_to_checkpoint);</div>
<div class="line"><span class="keyword">auto</span> training_session = <a class="code hl_class" href="class_ort_1_1_training_session.html">Ort::TrainingSession</a>(env, session_options, state, training_model_path,</div>
<div class="line">                                             eval_model_path, optimizer_model_path);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Training Loop</span></div>
<div class="line">{</div>
<div class="line">    training_session.TrainStep(...);</div>
<div class="line">    training_session.OptimizerStep(...);</div>
<div class="line">    training_session.LazyResetGrad(...);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">training_session-&gt;ExportModelForInferencing(inference_model_path, ...);</div>
<div class="line"><a class="code hl_function" href="class_ort_1_1_checkpoint_state.html#aeb65455e24b892fb64e2f375a86ddd4a">Ort::CheckpointState::SaveCheckpoint</a>(state, path_to_checkpoint, <span class="keyword">false</span>);</div>
<div class="ttc" id="aclass_ort_1_1_checkpoint_state_html_a0afa164a5656c00f59c5f5bcab17dce2"><div class="ttname"><a href="class_ort_1_1_checkpoint_state.html#a0afa164a5656c00f59c5f5bcab17dce2">Ort::CheckpointState::LoadCheckpoint</a></div><div class="ttdeci">static CheckpointState LoadCheckpoint(const std::basic_string&lt; ORTCHAR_T &gt; &amp;path_to_checkpoint)</div><div class="ttdoc">Load a checkpoint state from directory on disk into checkpoint_state.</div><div class="ttdef"><b>Definition</b> onnxruntime_training_cxx_inline.h:172</div></div>
<div class="ttc" id="aclass_ort_1_1_checkpoint_state_html_aeb65455e24b892fb64e2f375a86ddd4a"><div class="ttname"><a href="class_ort_1_1_checkpoint_state.html#aeb65455e24b892fb64e2f375a86ddd4a">Ort::CheckpointState::SaveCheckpoint</a></div><div class="ttdeci">static void SaveCheckpoint(const CheckpointState &amp;checkpoint_state, const std::basic_string&lt; ORTCHAR_T &gt; &amp;path_to_checkpoint, const bool include_optimizer_state=false)</div><div class="ttdoc">Save the given state to a checkpoint directory on disk.</div><div class="ttdef"><b>Definition</b> onnxruntime_training_cxx_inline.h:178</div></div>
<div class="ttc" id="aclass_ort_1_1_training_session_html"><div class="ttname"><a href="class_ort_1_1_training_session.html">Ort::TrainingSession</a></div><div class="ttdoc">Trainer class that provides training, evaluation and optimizer methods for training an ONNX models.</div><div class="ttdef"><b>Definition</b> onnxruntime_training_cxx_api.h:139</div></div>
<div class="ttc" id="astruct_ort_1_1_env_html"><div class="ttname"><a href="struct_ort_1_1_env.html">Ort::Env</a></div><div class="ttdoc">The Env (Environment)</div><div class="ttdef"><b>Definition</b> onnxruntime_cxx_api.h:411</div></div>
<div class="ttc" id="astruct_ort_1_1_session_options_html"><div class="ttname"><a href="struct_ort_1_1_session_options.html">Ort::SessionOptions</a></div><div class="ttdoc">Wrapper around ::OrtSessionOptions.</div><div class="ttdef"><b>Definition</b> onnxruntime_cxx_api.h:622</div></div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>&zwj;<b>Note</b> The <a class="el" href="class_ort_1_1_checkpoint_state.html" title="Holds the state of the training session.">Ort::CheckpointState</a> contains the entire training state that the <a class="el" href="class_ort_1_1_training_session.html" title="Trainer class that provides training, evaluation and optimizer methods for training an ONNX models.">Ort::TrainingSession</a> uses. As a result, the training session must always have access to the state. That is to say, the <a class="el" href="class_ort_1_1_checkpoint_state.html" title="Holds the state of the training session.">Ort::CheckpointState</a> instance must outlive the lifetime of the <a class="el" href="class_ort_1_1_training_session.html" title="Trainer class that provides training, evaluation and optimizer methods for training an ONNX models.">Ort::TrainingSession</a> instance. </p>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
